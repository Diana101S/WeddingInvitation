<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RSVP — Daniel & Diana</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{ --bg:#FFFFFF; --ink:#0f172a; --line:#e7e7e7; --brand:#86AEDB; }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:Pretendard,system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:720px;margin:0 auto;padding:24px 16px}
    .title{font-weight:700;font-size:22px;margin:4px 0 16px}
    .eyebrow{font-size:12px;color:#64748b;letter-spacing:.08em;text-transform:uppercase;margin:0}
    .btn{display:inline-flex;align-items:center;justify-content:center;height:44px;padding:0 14px;border-radius:10px;border:1px solid var(--line);background:#fff}
    .btn.brand{background:var(--brand);border-color:var(--brand);color:#fff;font-weight:700}
    .form{display:grid;gap:12px;margin-top:12px}
    .field{display:grid;gap:6px}
    .field label{font-size:14px;color:#475569}
    .field input,.field select,.field textarea{width:100%;padding:12px;border:1px solid var(--line);border-radius:10px;background:#fff;font-size:16px}
    .choices{display:flex;gap:16px;flex-wrap:wrap}
    .msg{margin-top:10px;font-size:14px}
    .msg.ok{color:#047857}.msg.err{color:#b91c1c}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div>
        <p class="eyebrow">RSVP</p>
        <h1 class="title">Daniel & Diana — RSVP</h1>
      </div>
      <!-- ✅ 상대경로로 변경 -->
      <a class="btn" href="./index.html">← Back</a>
    </div>

    <p>We’d be honored to celebrate with you. Please let us know if you’ll be able to attend.</p>

    <form id="rsvpForm" class="form" novalidate>
      <div class="field">
        <label for="name">Full name *</label>
        <input id="name" name="name" type="text" required placeholder="Your name" />
      </div>

      <div class="field">
        <label for="email">Email (optional)</label>
        <input id="email" name="email" type="email" placeholder="you@example.com" />
      </div>

      <div class="field">
        <label>Will you attend? *</label>
        <div class="choices">
          <label><input type="radio" name="attending" value="yes" required /> Yes, I will attend</label>
          <label><input type="radio" name="attending" value="no" /> No, I can’t attend</label>
        </div>
      </div>

      <div class="field">
        <label for="party_size">Total guests (including you)</label>
        <select id="party_size" name="party_size">
          <option value="1" selected>1 (Just me)</option>
          <option value="2">2</option><option value="3">3</option>
          <option value="4">4</option><option value="5">5</option>
          <option value="6">6</option>
        </select>
        <small style="color:#64748b">If you can’t attend, select “No” above.</small>
      </div>

      <div class="field">
        <label for="notes">Notes (dietary, seating, etc.)</label>
        <textarea id="notes" name="notes" rows="3" placeholder="Anything we should know?"></textarea>
      </div>

      <button id="submitBtn" class="btn brand" type="submit">Send RSVP</button>

      <p id="ok" class="msg ok" hidden aria-live="polite">Thank you! Your RSVP has been recorded.</p>
      <p id="err" class="msg err" hidden aria-live="polite">Sorry—something went wrong. Please try again.</p>
    </form>
  </div>

  <!-- Supabase insert -->
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

    const SUPABASE_URL = "https://khddckyznivjoluwtvxo.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtoZGRja3l6bml2am9sdXd0dnhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3MTk1NDYsImV4cCI6MjA3ODI5NTU0Nn0.zblwD4ETNzl1YlFBTfpqvxkvGPrE1RhawPLC9_iUxoE";
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const form = document.getElementById("rsvpForm");
    const btn  = document.getElementById("submitBtn");
    const ok   = document.getElementById("ok");
    const err  = document.getElementById("err");
    const party = document.getElementById("party_size");
    const radios = form.querySelectorAll('input[name="attending"]');

    // 참석 선택에 따라 party_size 제어
    radios.forEach(r=>{
      r.addEventListener('change', ()=>{
        const no = r.value==='no' && r.checked;
        party.disabled = no;
        if(no) party.value = "0";
        if(!no && party.value==="0") party.value="1";
      });
    });

    form.addEventListener("submit", async (e)=>{
      e.preventDefault();
      ok.hidden = true; err.hidden = true;

      const f = new FormData(form);
      const name = String(f.get("name")||"").trim();
      const email = String(f.get("email")||"").trim();
      const attendingVal = String(f.get("attending")||"");
      const notes = String(f.get("notes")||"").trim();

      if(!name || (attendingVal!=="yes" && attendingVal!=="no")){
        err.textContent = "Please fill the required fields.";
        err.hidden = false; return;
      }

      const attending = attendingVal==="yes";
      let party_size = parseInt(String(f.get("party_size") || (attending?"1":"0")),10)||0;
      if(!attending) party_size = 0;
      if(attending && (party_size<1 || party_size>6)) party_size = 1;

      btn.disabled = true; btn.textContent = "Sending…";

      const { error } = await supabase.from("rsvps").insert({
        name,
        email: email || null,
        attending,
        party_size,
        notes: notes || null
      });

      if(error){
        console.error(error);
        err.textContent = "Sorry—something went wrong. Please try again.";
        err.hidden = false;
      }else{
        form.reset();
        party.disabled = false; party.value = "1";
        ok.hidden = false;
      }
      btn.disabled = false; btn.textContent = "Send RSVP";
    });
  </script>
</body>
</html>
